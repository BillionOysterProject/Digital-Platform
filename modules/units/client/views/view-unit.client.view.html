<div class="jumbotron" style="background: {{vm.unit.color}}">
    <section class="content">
        <section class="container">
            <div class="row">
                <div class="col-md-4 col-sm-6 box text-center" style="color: {{vm.unit.color}}">
                    <h1><i class="{{vm.unit.icon}}"></i></h1>
                    <h2>{{vm.unit.title}}</h2>
                    <h6 ng-show="vm.unit.lessons && vm.unit.lessons.length > 0 && vm.unit.subUnits && vm.unit.subUnits.length > 0">
                      {{vm.unit.lessons.length}} Lessons | {{vm.unit.subUnits.length}} Sub Units
                    </h6>
                    <h6 ng-show="vm.unit.lessons && vm.unit.lessons.length > 0 && (!vm.unit.subUnits || vm.unit.subUnits.length <= 0)">
                      {{vm.unit.lessons.length}} Lessons
                    </h6>
                    <h6 ng-show="(!vm.unit.lessons || vm.unit.lessons.length <= 0) && vm.unit.subUnits && vm.unit.subUnits.length > 0">
                      {{vm.unit.subUnits.length}} Sub Units
                    </h6>
                </div>
                <div class="col-md-8 col-sm-6" ng-show="vm.unit.parentUnits.length > 1">
                    <br/><br/><br/>
                    <h4 class="white">Sub unit of <br/>
                        <span ng-repeat="parent in vm.unit.parentUnits">
                          <b class="h3"><a ui-sref="units.view({ unitId: parent._id })" class="white">{{parent.title}}</a></b>
                          <span ng-show="!$last"> and</span>
                        </span>
                    </h4>
                </div>
            </div>
        </section>
    </section>
</div>

<!--
<h5 ng-show="vm.unit.user">
    <img ng-show="vm.unit.user.profileImageURL" ng-src="{{vm.unit.user.profileImageURL}}" alt="{{vm.unit.user.displayName}}" class="header-profile-image" />
    <b><a ng-click="vm.openViewUserModal()">{{vm.unit.user.displayName}}</a></b><br>
    <a href="mailto:{{vm.unit.user.email}}">{{vm.unit.user.email}}</a>
</h5>
<p ng-bind="vm.unit.created | date:'mediumDate'"></p>
-->

<section class="content">
    <section class="container">
        <nav class="nav nav-default text-right">
            <a class="btn btn-primary" ui-sref="{{vm.editLink}}" ng-show="vm.unit.isCurrentUserOwner">
                {{vm.unit.status === 'published' ? 'Unpublish and edit' : 'Edit'}}</a>
            <a class="btn btn-default" ng-click="vm.openUnitFeedback()" ng-hide="vm.unit.isCurrentUserOwner">Send feedback</a>
            <!-- TODO: Wire up download
            <a class="btn btn-default" data-toggle="modal" data-target="#modal-download">Download</a>-->
        </nav>

        <div class="row">
            <div class="col-md-4">
                <h3>Highlights</h3>
                <div ng-bind-html="vm.unit.highlights | sanitize"></div>

                <h3>Rationale</h3>
                <div ng-bind-html="vm.unit.rationale | sanitize"></div>

                <hr ng-show="(vm.unit.standards.nycsssUnits && vm.unit.standards.nycsssUnits.length > 0) ||
                      (vm.unit.standards.nysssKeyIdeas && vm.unit.standards.nysssKeyIdeas.length > 0) ||
                      (vm.unit.standards.nysssMajorUnderstandings && vm.unit.standards.nysssMajorUnderstandings.length > 0) ||
                      (vm.unit.standards.nysssMst && vm.unit.standards.nysssMst.length > 0) ||
                      (vm.unit.standards.ngssDisciplinaryCoreIdeas && vm.unit.standards.ngssDisciplinaryCoreIdeas.length > 0) ||
                      (vm.unit.standards.ngssScienceEngineeringPractices && vm.unit.standards.ngssScienceEngineeringPractices.length > 0) ||
                      (vm.unit.standards.ngssCrossCuttingConcepts && vm.unit.standards.ngssCrossCuttingConcepts.length > 0) ||
                      (vm.unit.standards.cclsMathematics && vm.unit.standards.cclsMathematics.length > 0) ||
                      (vm.unit.standards.cclsElaScienceTechnicalSubjects && vm.unit.standards.cclsElaScienceTechnicalSubjects.length > 0)"/>

                <div class="row">
                  <div class="col-sm-12" id="unit-standards"
                    ng-show="(vm.unit.standards.nycsssUnits && vm.unit.standards.nycsssUnits.length > 0) ||
                          (vm.unit.standards.nysssKeyIdeas && vm.unit.standards.nysssKeyIdeas.length > 0) ||
                          (vm.unit.standards.nysssMajorUnderstandings && vm.unit.standards.nysssMajorUnderstandings.length > 0) ||
                          (vm.unit.standards.nysssMst && vm.unit.standards.nysssMst.length > 0) ||
                          (vm.unit.standards.ngssDisciplinaryCoreIdeas && vm.unit.standards.ngssDisciplinaryCoreIdeas.length > 0) ||
                          (vm.unit.standards.ngssScienceEngineeringPractices && vm.unit.standards.ngssScienceEngineeringPractices.length > 0) ||
                          (vm.unit.standards.ngssCrossCuttingConcepts && vm.unit.standards.ngssCrossCuttingConcepts.length > 0) ||
                          (vm.unit.standards.cclsMathematics && vm.unit.standards.cclsMathematics.length > 0) ||
                          (vm.unit.standards.cclsElaScienceTechnicalSubjects && vm.unit.standards.cclsElaScienceTechnicalSubjects.length > 0)">
                    <h3>Standards
                      {{vm.standardCount}}</h3>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.nycsssUnits && vm.unit.standards.nycsssUnits.length > 0">
                    <b>NYC Science Scope &amp; Sequence - Units</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="https://www.engageny.org/sites/default/files/resource/attachments/8m4.2.pdf" target="_blank">{{vm.unit.standards.nycScienceScopeSequence}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.nycsssUnits">
                        <span>{{standard.header}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.nysssKeyIdeas && vm.unit.standards.nysssKeyIdeas.length > 0">
                    <b>NYS Science Standards - Key Ideas</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.nextgenscience.org/next-generation-science-standards" target="_blank">{{vm.unit.standards.ngssStandards}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.nysssKeyIdeas">
                        <span>{{standard.header}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.nysssMajorUnderstandings && vm.unit.standards.nysssMajorUnderstandings.length > 0">
                    <b>NYS Science Standards - Major Understandings</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreEla}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.nysssMajorUnderstandings">
                        <span>{{standard.code}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.nysssMst && vm.unit.standards.nysssMst.length > 0">
                    <b>NYS Science Standards - MST</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.nysssMst">
                        <span>{{standard.code}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.ngssDisciplinaryCoreIdeas && vm.unit.standards.ngssDisciplinaryCoreIdeas.length > 0">
                    <b>NGSS - Disciplinary Core Ideas</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.ngssDisciplinaryCoreIdeas">
                        <span>{{standard.header}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.ngssScienceEngineeringPractices && vm.unit.standards.ngssScienceEngineeringPractices.length > 0">
                    <b>NGSS - Science and Engineering Practices</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.ngssScienceEngineeringPractices">
                        <span>{{standard.header}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.ngssCrossCuttingConcepts && vm.unit.standards.ngssCrossCuttingConcepts.length > 0">
                    <b>NGSS - Cross-Cutting Concepts</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.ngssCrossCuttingConcepts">
                        <span>{{standard.header}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.cclsMathematics && vm.unit.standards.cclsMathematics.length > 0">
                    <b>CCLS - Mathematics</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.cclsMathematics">
                        <span>{{standard.code}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                  <div class="{{vm.standardClass}}" ng-show="vm.unit.standards.cclsElaScienceTechnicalSubjects && vm.unit.standards.cclsElaScienceTechnicalSubjects.length > 0">
                    <b>CCLS - ELA Science &amp; Technical Subjects</b>
                    <!-- TODO: this needs to hold a title and pdf, but right now it's just a string -->
                    <!-- <span><a href="http://www.corestandards.org/ELA-Literacy/" target="_blank">{{vm.unit.standards.commonCoreMath}}</a></span> -->
                    <ul>
                      <li ng-repeat="standard in vm.unit.standards.cclsElaScienceTechnicalSubjects">
                        <span>{{standard.code}}
                          -
                          {{standard.description}}</span>
                      </li>
                    </ul>
                  </div>
                </div>
            </div>

            <div class="col-sm-8">
                <h3><!--TODO: Only show buttons to admin -->
                    <a class="btn btn-default pull-right" data-toggle="modal" data-modal="#modal-sequence-lessons" ng-show="vm.unit.lessons.length > 1">Edit sequence</a><!--TODO: wire up to go to LESSON sequence modal-->
                    <a class="btn btn-default pull-right">Add lesson</a><!--TODO: wire up to go to new lesson form with unit prepopulated with this unit?-->
                    Lessons
                </h3><br/>
                <div class="alert alert-info" ng-show="!vm.unit.lessons || vm.unit.lessons.length < 1">
                    Whoops, this unit doesn't have any lessons yet! Check back for updates.
                </div>
                <table class="table table-hover table-responsive" ng-show="vm.unit.lessons.length > 1">
                    <tr ng-repeat="lesson in vm.unit.lessons" ui-sref="lessons.view({ lessonId: lesson._id })">
                      <td><h4 class="blue"><b>{{($index+1)}}</b></h4></td>
                      <td>
                        <h4>{{lesson.title}}</h4>
                      </td>
                      <td>
                        <img ng-show="lesson.user.profileImageURL" ng-src="{{lesson.user.profileImageURL}}" alt="{{lesson.user.displayName}}" class="header-profile-image" />
                        {{lesson.user.displayName}}
                      </td>
                      <td><b>{{lesson.lessonOverview.setting}}</b> setting</td>
                      <td><b>{{lesson.lessonOverview.grade}}</b> grade</td>
                      <td>
                        <ul class="list-inline">
                            <li ng-repeat="subject in lesson.lessonOverview.subjectAreas">
                                <span ng-style="{'background-color':'{{subject.color}}'}" ng-bind="subject.subject"
                                class="label label-default"></span>
                            </li>
                        </ul>
                      </td>
                      <td>
                      <!--TIFF: check to make sure these popovers are wired up correctly -->
                        
                        <a href="#" uib-popover="{{lesson.lessonOverview.lessonSummary}}" popover-title="Summary" popover-trigger="mouseenter" popover-placement="top">Summary</a><br/>
                        <a href="#" uib-popover="{{lesson.lessonObjectives}}" popover-title="Objectives" popover-trigger="mouseenter" popover-placement="top">Objectives</a>
                      </td>
                      <td ng-show="lesson.stats.teamLeadCount > 0"><i class="fa fa-check"></i> Taught by <b>{{lesson.stats.teamLeadCount}}</b> teachers<td/>
                    </tr>
                </table>

                <h3 ng-show="vm.unit.subUnits && vm.unit.subUnits.length > 0">
                    <a class="btn btn-default pull-right" data-toggle="modal" data-modal="#modal-sequence-subunits">Edit sequence</a><!--TODO: wire up to go to SUBUNIT sequence modal-->
                    <a class="btn btn-default pull-right">Add sub unit</a> <!--TODO: wire up to go to new unit form with parent unit prepopulated with this unit?-->
                    Sub Units
                </h3><br/>
                <table class="table table-hover table-responsive" ng-show="vm.unit.subUnits && vm.unit.subUnits.length > 0">
                    <tr ng-repeat="unit in vm.unit.subUnits" ui-sref="units.view({ unitId: unit._id })">
                      <td><h4 class="blue"><b>{{($index+1)}}</b></h4></td>
                      <td>
                        <h4><i class="fa fa-tree green"></i> {{unit.title}}</h4>
                      </td>
                      <td><b>{{unit.lessons.length}}</b> Lessons</td>
                      <td><b>{{unit.subUnits.length}}</b> Sub Units</td>
                    </tr>
                </table>
            </div>
        </div>
    </section>
</section>


<!--MODALS-->
<div class="modal fade" id="modal-sequence-lesson" tabindex="-1" role="dialog">
<!--TODO: Wire up to enable drag and drop -- numbers should automatically update. Shouldn't save until "Save" button is clicked-->
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Edit lesson sequence</h4>
            </div>
            <div class="modal-body">
                <table class="table table-hover table-responsive" ng-show="vm.unit.lessons.length > 1">
                    <tr ng-repeat="lesson in vm.unit.lessons" ui-sref="lessons.view({ lessonId: lesson._id })">
                      <td><h4 class="blue"><b>{{($index+1)}}</b></h4></td>
                      <td>
                        <h4>{{lesson.title}}</h4>
                      </td>
                      <td>
                        <img ng-show="lesson.user.profileImageURL" ng-src="{{lesson.user.profileImageURL}}" alt="{{lesson.user.displayName}}" class="header-profile-image" />
                        {{lesson.user.displayName}}
                      </td>
                      <td><b>{{lesson.lessonOverview.setting}}</b> setting</td>
                      <td><b>{{lesson.lessonOverview.grade}}</b> grade</td>
                      <td>
                        <ul class="list-inline">
                            <li ng-repeat="subject in lesson.lessonOverview.subjectAreas">
                                <span ng-style="{'background-color':'{{subject.color}}'}" ng-bind="subject.subject"
                                class="label label-default"></span>
                            </li>
                        </ul>
                      </td>
                      <td>
                      <!--TIFF: check to make sure these popovers are wired up correctly -->
                        
                        <a href="#" uib-popover="{{lesson.lessonOverview.lessonSummary}}" popover-title="Summary" popover-trigger="mouseenter" popover-placement="top">Summary</a><br/>
                        <a href="#" uib-popover="{{lesson.lessonObjectives}}" popover-title="Objectives" popover-trigger="mouseenter" popover-placement="top">Objectives</a>
                      </td>
                      <td ng-show="lesson.stats.teamLeadCount > 0"><i class="fa fa-check"></i> Taught by <b>{{lesson.stats.teamLeadCount}}</b> teachers<td/>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Save</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-sequence-subunits" tabindex="-1" role="dialog">
<!--TODO: Wire up to enable drag and drop -- numbers should automatically update. Shouldn't save until "Save" button is clicked-->
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Edit sub unit sequence</h4>
            </div>
            <div class="modal-body">
                <table class="table table-hover table-responsive" ng-show="vm.unit.subUnits && vm.unit.subUnits.length > 0">
                    <tr ng-repeat="unit in vm.unit.subUnits" ui-sref="units.view({ unitId: unit._id })">
                      <td><h4 class="blue"><b>{{($index+1)}}</b></h4></td>
                      <td>
                        <h4><i class="fa fa-tree green"></i> {{unit.title}}</h4>
                      </td>
                      <td><b>{{unit.lessons.length}}</b> Lessons</td>
                      <td><b>{{unit.subUnits.length}}</b> Sub Units</td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Save</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-download" tabindex="-1" role="dialog"><!--TODO: Wire up modal-->
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Download <span class="red">{{vm.unit.title}}</span></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <div class="checkbox"><!--TODO: Pull in all lesson names inside the unit-->
                                <label><input type="checkbox" value="" checked> Lesson #1</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="" checked> Lesson #2</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="" checked> Lesson #3</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="" checked> Lesson #4</label>
                            </div>
                            <hr/>
                            <div class="checkbox">
                                <label><input type="checkbox" value="" checked> Include all Handouts</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" value="" checked> Include all Teacher Resources</label>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Download</button>
            </div>
        </div>
    </div>
</div>
<unit-feedback-modal unit="vm.unit" close-function="vm.closeUnitFeedback"></unit-feedback-modal>
<view-user-modal user="vm.unit.user" close-function="vm.closeViewUserModal"></view-user-modal>
<!-- END MODALS -->
