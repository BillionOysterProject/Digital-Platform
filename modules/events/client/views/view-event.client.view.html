<!-- <div class="jumbotron" ng-hide="vm.featuredImageURL"></div> -->
<div class="jumbotron" ng-show="vm.featuredImageURL" ng-background-image image-url="vm.featuredImageURL">
    <section class="content">
        <section class="container">
            <div class="row">
                <div class="col-md-4 col-sm-6 box pull-right text-center">
                    <div class="row">
                        <div class="col-xs-6" ng-class="{'col-xs-6': vm.past === false,
                        'col-xs-12': vm.past === true}" >
                            <span ng-show="vm.event.dates && vm.event.dates.length > 1"
                              ng-repeat="date in vm.event.dates">
                              <h3><b>{{vm.getEventDate(date.startDateTime)}}</b>
                                {{vm.getEventYear(date.startDateTime)}}</h3>
                              <h5>{{vm.getEventTimeRange(date.startDateTime, date.endDateTime)}}</h5>
                            </span>

                            <span ng-show="vm.event.dates && vm.event.dates.length === 1">
                              <h2><b>{{vm.getEventMonthShort(date.startDateTime)}}<br/>
                                <span class="h1">{{vm.getEventDay(date.startDateTime)}}</span></b>
                                <br/>{{vm.getEventYear(date.startDateTime)}}</h2>
                                <h5>{{vm.getEventTimeRange(date.startDateTime, date.endDateTime)}}</h5>
                            </span>
                        </div>

                        <div class="col-xs-6" ng-show="vm.past === false">
                            <!-- TIFF: If user is logged out, button should redirect to sign in page (they can click sign up from there), and then immediately return to this page when logged in -->

                            <span ng-hide="vm.event.isRegistered">
                              <span ng-show="!vm.event.maximumCapacity || vm.openSpots > 0">
                                <h1><i class="gray fa fa-calendar-times-o"></i></h1>
                                <h6 ng-show="vm.event.maximumCapacity">
                                  Only {{vm.openSpots}} spots remaining</h6>
                                <a class="btn btn-lg btn-danger" ng-click="vm.registerEvent()">Register now</a>
                              </span>
                              <span ng-hide="!vm.event.maximumCapacity || vm.openSpots > 0">
                                <h1><i class="gray fa fa-calendar-times-o"></i></h1>
                                <h6>Registration is closed</h6>
                              </span>
                            </span>

                            <span ng-show="vm.event.isRegistered">
                              <h1><i class="green fa fa-check"></i></h1>
                              <h6>You are registered!</h6>
                              <a class="btn btn-lg btn-primary" ng-click="vm.unregisterEvent()">Unregister</a>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>
</div>
<section class="content">
    <section class="container">
        <div class="row">
            <div class="col-sm-8">
                <h2 class="red">{{vm.event.title}}</h2>
            </div>
            <div class="col-sm-4 text-right" ng-show="vm.isAdmin && vm.event.isCurrentUserOwner">
                <a class="btn btn-default" ui-sref="events.edit({ eventId: vm.event._id })">Edit</a>
                <!--TIFF: link should take admin to new "create event" form with content copied from this event other than the date (same functionality as lesson duplication)-->
                <a class="btn btn-default" ng-click="vm.duplicateEvent()">Duplicate</a>
                <a class="btn btn-primary" data-toggle="modal" data-target="#modal-event-email">Email registrants</a>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <hr/>
                <div class="row text-center">
                    <h4 class="col-sm-4 text-muted" ng-show="vm.event.location.addressString">
                        <a href="#" data-toggle="modal" data-target="#modal-event-map">
                            <i class="fa fa-map-marker"></i>
                            <!-- <b>ORS Name</b> --><small>{{vm.event.location.addressString}}</small>
                        </a>
                    </h4>
                    <h4 class="text-muted" ng-class="{'col-sm-4': vm.event.location.addressString,
                      'col-sm-6': !vm.event.location.addressString,
                      'col-sm-12': vm.past && !vm.isAdmin}">
                        <span ng-show="!vm.past && (!vm.event.deadlineToRegister || vm.openSpots > 0)">
                          <i class="fa fa-clock-o"></i>
                          <b>{{vm.daysRemaining}} days</b>
                            <small>left to register</small>
                        </span>

                        <span ng-show="vm.event.deadlineToRegister && vm.openSpots <= 0">
                          <b>Registration closed</b>
                        </span>

                        <span ng-show="vm.past">
                          <b>Event is over</b>
                        </span>

                    </h4>
                    <h4 class="text-muted" ng-class="{'col-sm-4': vm.event.location.addressString,
                      'col-sm-6': !vm.event.location.addressString}" ng-show="!vm.past || (vm.past && vm.isAdmin)">
                        <i class="fa fa-users"></i>
                        <b>30/40 full</b>
                    </h4>
                </div>
                <hr/>
            </div>
        </div>
    </section>
</section>

<!-- TIFF: Show only if admin -->
<section class="content shaded" ng-show="vm.isAdmin">
    <section class="container">
        <div class="row">
            <div class="col-sm-12">
                <h3 class="blue">Registrants</h3>
                <table class="table table-condensed table-responsive">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Organization</th>
                            <th>Teams</th>
                            <th>Email</th>
                            <th>Date Registered</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="registrant in vm.event.registrants">
                            <td>{{registrant.user.displayName}}</td>
                            <td>{{registrant.user.schoolOrg.name}}</td>
                            <td>{{registrant.user.teams}}</td>
                            <td>{{registrant.user.email}}</td>
                            <td>{{vm.getRegistrationDate(registrant.registrationDate)}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</section>
<section class="content">
    <section class="container">
        <div class="row">
            <div class="col-sm-12">
                <b>
                  <span ng-show="vm.event.category.type === 'professional development'">Professional development</span>
                  <span ng-show="vm.event.category.type === 'field training'">Field training</span>
                  <span ng-show="vm.event.category.type === 'workshop'">Workshop</span>
                  <span ng-show="vm.event.category.type === 'expedition'">Expedition</span>
                  <span ng-show="vm.event.category.type === 'other'">{{vm.event.category.otherType}}</span>
                </b>
                <p>{{vm.event.description}}</p>
                <hr/>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3" ng-show="vm.event.resources && (vm.event.resources.resourcesFiles &&
              vm.event.resources.resourcesFiles.length > 0) || (vm.event.resources.resourcesLinks &&
              vm.event.resources.resourcesLinks.length > 0)">
                <ul class="list-unstyled">
                    <b>Resources</b>
                    <li ng-repeat="file in vm.event.resources.resourcesFiles">
                        <a class="break" download="{{file.originalname}}" target="_blank"
                        ng-href="/api/events/download-file?mimetype={{file.mimetype}}&path={{file.path}}">
                        <i class="glyphicon glyphicon-file"></i> {{file.originalname}}</a>
                    <li>
                    <li ng-repeat="link in vm.event.resources.resourcesLinks">
                        <a class="break" href="{{link.link | urlNormalizer}}" target="_blank">
                        <i class="glyphicon glyphicon-link"></i> {{link.name}}</a>
                    </li>
                </ul>
            </div>
            <div class="col-sm-9">
                <p ng-show="vm.event.skillsTaught"><b>Skills taught:</b> {{vm.event.skillsTaught}}</p>
                <p ng-show="vm.event.cost"><b>Cost:</b> {{vm.event.cost}}</p>
            </div>
        </div>
    </section>
</section>


<!-- MODALS -->
<div class="modal fade" id="modal-event-email">
    <div class="modal-dialog" role="document">
        <div class="modal-content" ng-hide="sent">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Send an email to all <b class="red">30</b> current registrants</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Subject</label>
                            <input type="text" class="form-control" ng-model="subject" required/>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label">Message body</label>
                            <textarea class="form-control" rows="4" ng-model="message" ng-required="type === 'general' || type === 'help'"></textarea>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <input type="checkbox" />
                            <label class="control-label">Include text at end:</label>
                            <blockquote>
                                <p>You are currently registered for the <b class="red">BOP Restoration Station Basic Training</b> on <b class="red">October 7, 2016, 8:00am-5:00pm</b>. No longer able to attend? <a href="#">Unregister here</a> to give your spot to somebody else.</p>
                            </blockquote>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" ng-click="close()">Cancel</button>
              <button type="submit" class="btn btn-primary">Send</button>
            </div>
        </div>
        <div class="modal-content" ng-show="sent">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Your message has been sent!</h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" ng-click="close()">Close</button>
            </div>
        </div>
    </div>
</div>

<register-event-modal can-register="(vm.isAdmin || vm.isTeamLead) ? true : false"
  event="vm.event" date-string="{{vm.earliestDateString}}"
  support-function="vm.openFeedback"></register-event-modal>

<unregister-event-modal event="vm.event" date-string="{{vm.earliestDateString}}">
  </unregister-event-modal>

<!-- TIFF: Wire up modal (copied from another map)-->
<div class="modal fade" id="modal-event-map">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">123 Main Street</h4>
                <h5><i class="fa fa-map-marker"></i> <b>ORS Name</b></h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                      <leaflet-map map-controls="vm.mapControls" show-marker="vm.showMarker"></leaflet-map>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
