<section class="content shaded">
    <section class="container-fluid">
        <div class="page-header">
            <div class="row">
                <h2 class="col-md-8">Restoration Stations</h2>
                <div class="col-md-4">
                    <div class="btn-group pull-right" ng-show="vm.teams.length > 1">
                      <button type="button" class="btn btn-lg btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{vm.team.name}} <span class="caret"></span><!--If only a member/teacher of 1 team, hide this caret -->
                      </button>
                      <ul class="dropdown-menu">
                        <li ng-repeat="team in vm.teams"><a href="#" ng-click="vm.fieldChanged(team)">{{team.name}}</a></li>
                      </ul>
                    </div>
                    <div class="btn-group pull-right" ng-show="vm.teams.length < 1">
                      <button type="button" class="btn btn-lg btn-success">{{vm.team.name}}</button>
                    </div>
                    <h5><img ng-src="{{vm.team.teamLead.profileImageURL}}" class="header-profile-image pull-left"> {{vm.team.teamLead.displayName}}<br />
                      <small class="text-muted">{{vm.team.schoolOrg.city}}, {{vm.team.schoolOrg.state}}</small>
                    </h5>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4>Oyster Restoration Stations</h4>
                    </div>
                    <div class="panel-body">
                      <leaflet-map map-controls="" map-click-event="" marker-drag-end-event="" can-move-marker="" show-marker=""></leaflet-map>
                    </div>
                </div>
                <div class="row" ng-show="vm.isTeamLead">
                    <div class="col-lg-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4>Team Members <span class="badge badge-success pull-right">{{vm.members.length}}</span></h4>
                            </div>
                            <div class="panel-body">
                                <p ng-repeat="member in vm.members"><img ng-src="{{member.profileImageURL}}" class="header-profile-image"> {{member.displayName}}</p>
                            </div>
                            <div class="panel-footer">
                                <a class="btn btn-primary" ui-sref="settings.admin-team-owner">Add student</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4" ng-show="vm.isTeamLead">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4>Activity <span class="badge badge-success pull-right">{{vm.activities.length}}</span></h4>
                            </div>
                            <div class="panel-body">
                                <div class="alert alert-success">{{vm.activities.length}} members updated their protocols</div>
                                <div class="row" ng-repeat="activity in vm.activities">
                                    <div class="col-sm-2 col-xs-4">
                                        <img ng-src="{{activity.user.profileImageURL}}" class="header-profile-image">
                                    </div>
                                    <div class="col-sm-10 col-xs-8">
                                        <p>{{activity.user.displayName}} <small class="text-muted" am-time-ago="activity.created"></small><br />
                                        <span class="text-muted">{{activity.status}}</span>
                                        <a ui-sref="expeditions.protocols({ expeditionId: activity.expedition._id })">{{vm.displaySubmittedProtocols(activity)}}</a></p>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-footer">
                                <a class="btn btn-primary" ui-sref="expeditions.submitted">View Submissions</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4" ng-show="vm.isTeamLead">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4>Documents</h4>
                            </div>
                            <div class="panel-body">
                                <p><a href="https://drive.google.com/folderview?id=0Bzf_STNcTtRmbG1pMVpUM1lGUmM&usp=sharing" target="_blank"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;&nbsp;Resources & Curriculum</a></p>
                                <p><a href="https://drive.google.com/folderview?id=0Bzf_STNcTtRmU3dPVXNEaGdrRVE&usp=sharing" target="_blank"><i class="glyphicon glyphicon-folder-open pull-left"></i>&nbsp;&nbsp;Data Sheets</a></p>
                                <p><a href="https://drive.google.com/folderview?id=0Bzf_STNcTtRmRlNLTUFTbG5pWGs&usp=sharing" target="_blank"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;&nbsp;Manuals</a></p>
                                <p><a href="https://drive.google.com/folderview?id=0BwOkf1kzdWyncFR4SFRHMkJMZkU&usp=sharing" target="_blank"><i class="glyphicon glyphicon-folder-open"></i>&nbsp;&nbsp;Species ID</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="panel panel-default" ng-show="vm.isTeamLead">
                    <div class="panel-heading">
                        <h4>Team ORS</h4>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover">
                            <tr ng-repeat="station in vm.stations" ng-click="vm.canEditRestorationStation(station)">
                                <td><h3>
                                  <i class="glyphicon glyphicon-map-marker green" ng-show="station.status === 'Active'"></i>
                                  <i class="glyphicon glyphicon-map-marker red" ng-show="station.status === 'Lost'"></i>
                                </h3></td>
                                <td>{{station.name}}<br/><span class="small text-muted">{{station.latitude}}, {{station.longitude}}<br />
                                  {{station.bodyOfWater}}</span>
                                </td>
                                <td class="text-right">
                                  <span class="label label-success" ng-show="station.status === 'Active'">Active</span>
                                  <span class="label label-default" ng-show="station.status === 'Lost'">Lost</span>
                                </td>
                              </tr>
                        </table>
                    </div>
                    <div class="panel-footer">
                        <a class="btn btn-primary" ng-click="vm.openFormRestorationStation()">Register a station</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4>Team Expeditions</h4>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover">
                            <tr class="text-muted" ng-repeat="expedition in vm.expeditions"
                             ui-sref="expeditions.protocols({ expeditionId: expedition._id })">
                                <td ng-show="vm.isUpcoming(expedition)"><i class="glyphicon glyphicon-unchecked"></i></td>
                                <td ng-show="((vm.checkStatusIncomplete(expedition) || vm.checkStatusReturned(expedition)) && vm.isTeamMember) ||
                                ((expedition.status === 'incomplete' || expedition.status === 'returned') && vm.isTeamLead)">
                                  <i class="glyphicon glyphicon-unchecked red"></i>
                                </td>
                                <td ng-show="vm.checkStatusPending(expedition) && vm.isTeamMember">
                                  <i class="glyphicon glyphicon-check red"></i>
                                </td>
                                <td ng-show="expedition.status === 'pending' && vm.isTeamLead">
                                  <i class="glyphicon glyphicon-unchecked red"></i>
                                </td>
                                <td ng-show="expedition.status === 'published'"><i class="glyphicon glyphicon-check green"></i></td>
                                <td><b>{{expedition.name}}</b><br/><p class="text-muted">{{vm.getExpeditionDate(expedition)}}</br>
                                  {{vm.getExpeditionTimeRange(expedition)}}</p></td>
                                <td class="text-right" ng-show="vm.isUpcoming(expedition)">
                                  <span class="label label-default">Coming up</span>
                                </td>
                                <td class="text-right" ng-show="((vm.checkStatusIncomplete(expedition) || vm.checkStatusReturned(expedition)) && vm.isTeamMember) ||
                                ((expedition.status === 'incomplete' || expedition.status === 'returned') && vm.isTeamLead)">
                                  <span class="label label-danger">Incomplete</span>
                                </td>
                                <td class="text-right" ng-show="vm.checkStatusPending(expedition) && vm.isTeamMember">
                                  <span class="label label-danger">Pending</span>
                                </td>
                                <td class="text-right" ng-show="expedition.status === 'pending' && vm.isTeamLead">
                                  <span class="label label-danger">Submitted</span>
                                </td>
                                <td class="text-right" ng-show="expedition.status === 'published'">
                                  <span class="label label-success">Published</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="panel-footer">
                        <a class="btn btn-default" ui-sref="expeditions.list">See all</a>
                        <a class="btn btn-primary" ui-sref="expeditions.create" ng-show="vm.isTeamLead">Create an expedition</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>






<!-- MODALS -->
<form-restoration-station-modal station="vm.station" teams="vm.teams" save-function="vm.saveFormRestorationStation"
cancel-function="vm.cancelFormRestorationStation"></form-restoration-station-modal>
<!--END MODALS-->
